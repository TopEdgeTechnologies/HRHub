@using Newtonsoft.Json;
@model HRHUBAPI.Models.StaffSalary

<!--Add expense Modal -->
<div class="modal fade" id="viewsalarymodal">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Salary Slip</h5>
				<button class="btn-close" data-bs-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">×</span>
				</button>
			</div>
			<div class="modal-header">

				@*@{


					string jsonUser = HttpContextAccessor.HttpContext.Session.GetString("AuthenticatedUser");
					var myObjectUser = JsonSerializer.Deserialize<HRHUBAPI.Models.User>(jsonUser);
					var imagesComapny = myObjectUser.LogoAttachment == null ? @"~\Images\Avatar.png" : myObjectUser.LogoAttachment;
					


				}*@
				<div class="d-flex">
					<img id="imgLogo" src="../assets/images/brand/logo.png" class="avatar avatar-md brround me-3"> Top Edge Technologies
                    @*<img id="imgLogo" src="../assets/images/brand/logo.png" class="header-brand-img" alt="Dayonelogo">*@
                </div>

				<div class="ms-auto">
					<div class="font-weight-bold text-md-right mt-3">Date: 01-02-2021</div>
				</div>
			</div>
			<div class="modal-body pt-1">
				<div class="table-responsive mt-3 mb-3">
					<table class="table mb-0 modal-paytable">
						<tbody>
							<tr>
								<td>
									<strong>RegistrationNo:</strong>
									<span id="lbl_regNo">2987</span>
								</td>
								<td class="text-end">
									<strong>Name:</strong>
									<span id="lbl_firstName">Faith Harris</span>
								</td>
							</tr>
							<tr>
								<td>
									<strong>Department:</strong>
									<span id="lbl_Department">USA</span>
								</td>
								<td class="text-end">
									<strong>Salary Period:</strong>
									<span id="lbl_SalaryPeriod">January-2021</span>
								</td>
							</tr>
						</tbody>
					</table>
				</div>

				<div class="row">
					<div class="col-md-6">
						<table class="table table-bordered text-nowrap mb-0">
							<thead>
								<tr>
									<th class="fs-18" rowspan="1" colspan="2">Earnings</th>
								</tr>
								<tr>
									<th>Pay Type</th>
									<th class="border-start">Amount</th>
								</tr>
							</thead>
							<tbody id="tBodyEarning">

							</tbody>
							<tfoot>
								<tr class="border-top">
									<td class="font-weight-semibold">Total Earnings</td>
									<td id="lbl_earnings" class="font-weight-semibold border-start">$32,000</td>
								</tr>
							</tfoot>
						</table>
					</div>
					<div class="col-md-6">
						<table class="table table-bordered text-nowrap mb-0 border-1">
							<thead>
								<tr>
									<th class="fs-18" rowspan="1" colspan="2">Deduction</th>
								</tr>
								<tr>
									<th>Pay Type</th>
									<th class="border-start">Amount</th>
								</tr>
							</thead>
							<tbody id="tBodyDeduction">
								
							</tbody>
							<tfoot>
								<tr class="border-top">
									<td class="font-weight-semibold">Total Deduction</td>
									<td id="lbl_deductions" class="font-weight-semibold border-start">$32,000</td>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>
				<div class="mt-4 mb-3">
					<table class="table mb-0">
						<tbody>
							<tr>
								<td class="font-weight-semibold w-20 fs-18 pb-0 pt-0">Net Salary</td>
								<td class="pb-0 pt-0">
									<h4 id="lbl_netSalary" class="font-weight-semibold mb-0 fs-24">$32,000</h4>
								</td>
							</tr>
							<tr>
								<td class="font-weight-semibold w-20 pb-0 pt-1 text-muted">InWords</td>
								<td class="pb-0 pt-1">
									<h5 id="lbl_netSalaryInWords" class="mb-0  text-muted">Thirty-Two Thousand only</h5>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<div class="p-5 border-top text-center">
				<div class="text-center">
					<h6 class="mb-2">Top Edge Technologies Pvt Ltd.</h6>
					<p class="mb-1 fs-12">Royal Orchard, Business Plaza Basement, Multan, South Punjab Pakistan</p>
					<div>
						<small>Tel No: 99488 67536,</small>
						<small>Email: info@topedgetechnologies.com</small>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<div class="ms-auto">
					<a href="javascript:void(0);" class="btn btn-info" onclick="javascript:window.print();"><i class="si si-printer"></i> Print</a>
					<a href="javascript:void(0);" class="btn btn-success"><i class="feather feather-download"></i> Download</a>
					<a href="javascript:void(0);" class="btn btn-primary"><i class="si si-paper-plane"></i> Send</a>
					<a href="javascript:void(0);" class="btn btn-danger" data-bs-dismiss="modal"><i class="feather feather-x"></i> Close</a>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- End Addexpense Modal  -->

<div class="side-app main-container">

		<input type="hidden" id="salaryMonth" value="5" />
		<input type="hidden" id="salaryYear" value="2023"/>
		<!--Page header-->
		
		<!--End Page header-->
		<!-- Row -->
		<div class="row">
			<div class="col-md-12">
				<div class="card">
					<div class="card-body">
						<div class="page-header d-xl-flex d-block">
							<div class="page-leftheader">
								<div class="page-title">Staff Salary</div>
							</div>
							<div class="page-rightheader ms-md-auto">
								<div class="d-flex align-items-end flex-wrap my-auto end-content breadcrumb-end">
									<div class="btn-list mt-3 mt-lg-0">
										<a href="hr-addpayroll.html" class="btn btn-primary me-3">Generate Salaries</a>
										<button class="btn btn-secondary me-3" data-bs-toggle="modal" data-bs-target="#excelmodal">
											<i class="las la-file-excel"></i>  Download Monthly Excel Report
										</button>
										<button class="btn btn-light" data-bs-toggle="tooltip" data-bs-placement="top" title="E-mail"> <i class="feather feather-mail"></i> </button>
										<button class="btn btn-light" data-bs-placement="top" data-bs-toggle="tooltip" title="Contact"> <i class="feather feather-phone-call"></i> </button>
										<button class="btn btn-primary" data-bs-placement="top" data-bs-toggle="tooltip" title="Info"> <i class="feather feather-info"></i> </button>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="card-body">
						<div class="table-responsive">
							<table class="table  table-vcenter text-nowrap table-bordered border-bottom" id="hr-payroll">
								<thead>
									<tr>
										<th class="border-bottom-0 w-5">Sr.#</th>
										<th class="border-bottom-0">Name</th>
										<th class="border-bottom-0">Reg.#</th>
										<th class="border-bottom-0">Department</th>
										<th class="border-bottom-0">Designation</th>
										<th class="border-bottom-0">Salary</th>
										<th class="border-bottom-0">Status</th>
										<th class="border-bottom-0">Actions</th>
									</tr>
								</thead>
								<tbody>
								@{
									int a = 0;
									if (Model.StaffSalaryList != null && Model.StaffSalaryList.Count() > 0)
									{
										foreach (var item in Model.StaffSalaryList)
										{
											<tr id="row_@a">
												<td>@Html.DisplayFor(modelitem => item.SNO)</td>
												<td>
													<div class="d-flex">
														@{
															string snapPath = "";
															if (@item.SnapPath != null && @item.SnapPath != "")
															{
																snapPath = @item.SnapPath;
															}
															else
															{
																snapPath = "/Images/Avatar.png";
															}
														}
														<img class="avatar avatar-md brround me-3" src="@snapPath">

														<div class="me-3 mt-0 mt-sm-1 d-block">
															@{
																string fullName = item.FirstName + " " + item.LastName;
															}
															<h6 class="mb-1 fs-14">@fullName</h6>
															<p class="text-muted mb-0 fs-12">@Html.DisplayFor(modelitem => item.ContactNumber) | @Html.DisplayFor(modelitem => item.Email)</p>
														</div>
													</div>
												</td>
												<td>@Html.DisplayFor(modelitem => item.RegistrationNo)</td>
												<td>@Html.DisplayFor(modelitem => item.DepartmentTitle)</td>
												<td>@Html.DisplayFor(modelitem => item.DesignationTitle)</td>
												<td class="font-weight-semibold"> @Convert.ToDecimal(item.CalculatedSalaryAmount).ToString("N2")</td>
												@{
													string SalaryStatusTitle = "";
													if(item.SalaryStatusTitle == "")
													{
														SalaryStatusTitle = "Prepared";
													}
													else
													{
														SalaryStatusTitle = item.SalaryStatusTitle;
													}
												}
												<td><span class="badge badge-success">@SalaryStatusTitle</span></td>
												<td class="text-start">
												
													<a onclick="ViewSalaryCard(@item.StaffId)" class="action-btns" data-bs-toggle="modal">
														<i class="feather feather-eye text-primary" data-bs-toggle="tooltip" data-bs-placement="top" title="View"></i>
													</a>
													@*
													<a href="javascript:void(0);" class="action-btns" data-bs-toggle="modal" data-bs-target="#viewsalarymodal">
														<i class="feather feather-eye text-primary" data-bs-toggle="tooltip" data-bs-placement="top" title="View"></i>
													</a>*@
													<a href="hr-editpayroll.html" class="action-btns" data-bs-toggle="tooltip" data-bs-placement="top" title="Edit">
														<i class="feather feather-edit text-info"></i>
													</a>
													<a href="javascript:void(0);" class="action-btns" data-bs-toggle="tooltip" data-bs-placement="top" title="Download">
														<i class="feather feather-download  text-secondary"></i>
													</a>
													<a href="javascript:void(0);" class="action-btns" data-bs-toggle="tooltip" data-bs-placement="top" title="Print" onclick="javascript:window.print();">
														<i class="feather feather-printer text-success"></i>
													</a>
													<a href="javascript:void(0);" class="action-btns" data-bs-toggle="tooltip" data-bs-placement="top" title="Share">
														<i class="feather feather-share-2 text-warning"></i>
													</a>
													<a href="javascript:void(0);" class="action-btns" data-bs-toggle="tooltip" data-bs-placement="top" title="Delete">
														<i class="feather feather-x text-danger"></i>
													</a>
												</td>
											</tr>
										}
									}
								}									
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- End Row -->

	</div><!-- end app-content-->

@section scripts{

	<script>

		$(document).ready(function(){

		});

		var dtStaffSalaryCardHtml;

		function ViewSalaryCard(staffId) {
			var Data = { month: $('#salaryMonth').val(), year: $("#salaryYear").val(), staffId: staffId }
			console.log(Data)
			$.ajax({
				async: false,
				url: "/PayrollConfiguration/GetStaffSalaryById",
				type: "GET",
				data: Data,
				success: function (data) {
					if (data != "") 
					{
						console.log(data)
						debugger
						
						var netSalary = 0.0
						var netSalaryInWords = ''
						var cardEarningHtml = ''
						var cardDeductionHtml = ''
						var totalEarningComponentAmount = 0.0
						var totalDeductionComponentAmount = 0.0
						
						/*
						//Apply filter to data array
						data = data.filter(function (item) {
							// Apply your filter condition here
							// For example, let's assume we want to include only components with amounts greater than 1000
							//return item.componentAmount > 1000;
							return item.category == "Deduction";
						});
						*/
						var regNo = ''
						var empName = ''
						var department = ''
						
						if(data.length > 0)
						{
							regNo = data[0].registrationNo
							$('#lbl_regNo').text(regNo)
							empName = data[0].firstName + ' ' + data[0].lastName
							$('#lbl_firstName').text(empName)
							department = data[0].departmentTitle
							$('#lbl_Department').text(department)							
							$('#lbl_SalaryPeriod').text($('#salaryMonth').val() + ' - ' + $('#salaryYear').val())
							//"/Images/Avatar.png"
							if (data[0].snapPath != null && data[0].snapPath != '') 
							{
								$('#imgLogo').attr('src', data[0].snapPath)
							}
							else
							{
								$('#imgLogo').attr('src', '/Images/Avatar.png')
							}
							
						}

						var j = 0
						for(var i = 0; i< data.length; i++) 
						{
							if (data[i].category == "Earning")
							{
								cardEarningHtml += '<tr id="' + i + '">'
								cardEarningHtml += '<td> ' + data[i].componentTitle + ' </td>'
								cardEarningHtml += '<td class="border-start"> ' + data[i].componentAmount.toLocaleString() + ' </td>'
								cardEarningHtml += '</tr>'
								totalEarningComponentAmount += parseFloat(data[i].componentAmount)
							}
							else if (data[i].category == "Deduction") 
							{
								cardDeductionHtml += '<tr id="' + j + '">'
								cardDeductionHtml += '<td> ' + data[i].componentTitle + ' </td>'
								cardDeductionHtml += '<td class="border-start"> ' + data[i].componentAmount.toLocaleString() + ' </td>'
								cardDeductionHtml += '</tr>'
								totalDeductionComponentAmount += parseFloat(data[i].componentAmount)
								j++
							}
						}

						$("#tBodyEarning").html(cardEarningHtml)
						var lbl_earnings = document.getElementById("lbl_earnings")
						lbl_earnings.innerText = totalEarningComponentAmount.toLocaleString()

						$("#tBodyDeduction").html(cardDeductionHtml)
						var lbl_deductions = document.getElementById("lbl_deductions")
						lbl_deductions.innerText = totalDeductionComponentAmount.toLocaleString()

						netSalary = totalEarningComponentAmount - totalDeductionComponentAmount
						var lbl_netSalary = document.getElementById("lbl_netSalary")
						lbl_netSalary.innerText = netSalary.toLocaleString(undefined, { maximumFractionDigits: 0 });
						$('#lbl_netSalaryInWords').text(numberToWords(netSalary.toFixed(0)))
						
						$("#viewsalarymodal").modal('show')
					}
				},
				error: function () {
					status = false;
					//   toastr.error("Please Fill Required Field");
				}
			})
		}

</script>

}